#lang typed/racket/base

(module+ test
(require racket/list
         racket/set
         typed/rackunit
         racket/pretty)

;; we don't want refactoring to change existing flow-charts.
;; these regression tests could catch that.
 

(require "flow-chart.rkt")

;; when this test case fails, you're going to want a better diagnostic...

(define test-val : (Immutable-HashTable Any (Setof Any))
  (make-immutable-hash
   (for/list : (Listof (Pair Any (Setof Any)))
     ([key (in-list (hash-keys all-flowcharts))])
     (ann
      (cons key
            (list->set
             (map (inst first Any)
                  (hash-ref all-flowcharts key))))
      (Pair Any (Setof Any))))))

  ;; use this to reset the regression test
  (define reset-val
    (for/list : (Listof (Pair Any (Listof Any)))
     ([key (in-list (hash-keys all-flowcharts))])
     (ann
      (cons key
            (map (inst first Any)
                 (hash-ref all-flowcharts key)))
      (Pair Any (Listof Any)))))
  ;(pretty-write reset-val)

(define expected-val : (Immutable-HashTable Any (Setof Any))
  (make-immutable-hash
   (map
    ;; convert lists to sets to disregard order
    (Î» ([pr : (Pair Any (Listof Any))]) : (Pair Any (Setof Any))
      (cons (car pr) (list->set (cdr pr))))
    '((((EE) "2020-2021")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((SE) "2022-2026")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365"
  (se-TE/123))
 (((SE ftf) "2020-2021")
  (se-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365")
 (((SE) "2020-2021")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365"
  (se-TE/123))
 (((SE ftf) "2022-2026")
  (se-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365")
 (((CPE ftf) "2022-2026")
  (cpe-TE/123)
  "csc101"
  "csc202"
  "cpe133"
  "cpe233"
  "ee115"
  "ee145"
  "csc203"
  "ee215"
  "ee245"
  (cpe-arch)
  "ee315"
  "csc357"
  "csc348"
  (cpe-signals)
  (cpe-TE-0)
  "csc453"
  "cpe464"
  (cpe-security)
  (cpe-TE-1)
  (microcon2)
  "cpe350"
  "cpe450"
  (cpe-sp-1)
  (cpe-TE-2)
  (cpe-sp-2)
  (cpe-TE/400))
 (((CSC) "2019-2020")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  (ethics)
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  (csc-TE-4)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3)
  (csc-TE/123))
 (((CPE ftf) "2019-2020")
  (cpe-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0))
 (((SE) "2021-2022")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365"
  (se-TE/123))
 (((CSC) "2020-2021")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  (ethics)
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  (csc-TE-4)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3)
  (csc-TE/123))
 (((EE ftf) "2019-2020")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((SE) "2017-2019")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  "csc300"
  (se-TE-2)
  "csc491"
  "csc492"
  (se-TE/123))
 (((SE ftf) "2021-2022")
  (se-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365")
 (((CPE) "2021-2022")
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0)
  (cpe-TE/123))
 (((EE ftf) "2020-2021")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CPE ftf) "2020-2021")
  (cpe-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0))
 (((CSC) "2021-2022")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc348"
  "csc349"
  (security)
  "csc430"
  (ethics)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (upper-level-csc-TE)
  (csc-TE/special-problems)
  "cpe315"
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3)
  (csc-TE/123))
 (((EE ftf) "2021-2022")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CPE) "2020-2021")
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0)
  (cpe-TE/123))
 (((SE) "2019-2020")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365"
  (se-TE/123))
 (((EE) "2021-2022")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CPE ftf) "2021-2022")
  (cpe-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0))
 (((CSC ftf) "2020-2021")
  (csc-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  (ethics)
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  (csc-TE-4)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3))
 (((CPE ftf) "2017-2019")
  (cpe-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  "cpe133"
  "cpe329"
  "cpe315"
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0))
 (((EE) "2022-2026")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CSC ftf) "2021-2022")
  (csc-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc348"
  "csc349"
  (security)
  "csc430"
  (ethics)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (upper-level-csc-TE)
  (csc-TE/special-problems)
  "cpe315"
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3))
 (((EE) "2019-2020")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CSC) "2017-2019")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc300"
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  "csc431"
  "csc445"
  "csc453"
  "csc491"
  "csc492"
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3)
  (csc-TE/123))
 (((SE ftf) "2017-2019")
  (se-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  "csc300"
  (se-TE-2)
  "csc491"
  "csc492")
 (((EE ftf) "2022-2026")
  "ee111"
  "ee151"
  "csc101"
  (circuits)
  (circuits-lab)
  "ee211"
  "ee241"
  "cpe133"
  "ee212"
  "ee242"
  "cpe233"
  "ee255"
  "ee295"
  "ee228"
  "ee335"
  "ee375"
  "ee306"
  "ee346"
  "cpe328"
  "cpe368"
  "ee402"
  "ee307"
  "ee347"
  "ee302"
  "ee342"
  "ee314"
  "ee308"
  "ee348"
  (ee-microcon)
  "ee409"
  "ee449"
  "ee460"
  (ee-TE-0)
  (ee-TE-1)
  (ee-sp-1)
  (ee-TE-2)
  (ee-sp-2))
 (((CSC) "2022-2026")
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc348"
  "csc349"
  (security)
  "csc430"
  (ethics)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (upper-level-csc-TE)
  (csc-TE/special-problems)
  (distributed)
  "csc365"
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE/123))
 (((CPE) "2022-2026")
  "csc101"
  "csc202"
  "cpe133"
  "cpe233"
  "ee115"
  "ee145"
  "csc203"
  "ee215"
  "ee245"
  (cpe-arch)
  "ee315"
  "csc357"
  "csc348"
  (cpe-signals)
  (cpe-TE-0)
  "csc453"
  "cpe464"
  (cpe-security)
  (cpe-TE-1)
  (microcon2)
  "cpe350"
  "cpe450"
  (cpe-sp-1)
  (cpe-TE-2)
  (cpe-sp-2)
  (cpe-TE/400)
  (cpe-TE/123))
 (((CSC ftf) "2017-2019")
  (csc-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc300"
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  "csc431"
  "csc445"
  "csc453"
  "csc491"
  "csc492"
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3))
 (((SE ftf) "2019-2020")
  (se-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  "csc348"
  "csc357"
  "csc305"
  "csc308"
  "csc309"
  "csc349"
  "csc430"
  "csc484"
  (se-TE-0)
  "csc402"
  "csc405"
  "csc406"
  (upper-level-se-TE)
  (special-problems/se-TE)
  (se-TE-1)
  (ethics)
  "csc365")
 (((CSC ftf) "2019-2020")
  (csc-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  (ethics)
  "cpe315"
  "csc348"
  "csc349"
  "csc430"
  (csc-TE-4)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (csc-TE/special-problems)
  (upper-level-csc-TE)
  (csc-TE-1)
  (csc-TE-2)
  (csc-TE-3))
 (((CPE) "2019-2020")
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  (circuits)
  (cpe-circuits-lab)
  "cpe133"
  "ee211"
  "ee241"
  "ee212"
  "ee242"
  (cpe-signals)
  "ee306"
  "ee346"
  "ee307"
  "ee347"
  (cpe-arch)
  (microcon)
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0)
  (cpe-TE/123))
 (((CSC ftf) "2022-2026")
  (csc-TE/123)
  "csc101"
  "csc202"
  "csc203"
  "csc225"
  (csc-SE)
  "csc357"
  (csc-TE-0)
  "csc348"
  "csc349"
  (security)
  "csc430"
  (ethics)
  "csc445"
  "csc453"
  (csc-sp-1)
  (csc-sp-2)
  (upper-level-csc-TE)
  (csc-TE/special-problems)
  (distributed)
  "csc365"
  (csc-TE-1)
  (csc-TE-2))
 (((CPE) "2017-2019")
  "csc101"
  "csc202"
  "csc203"
  "cpe233"
  "csc357"
  "cpe350"
  "cpe450"
  "csc453"
  "cpe464"
  "csc348"
  (cpe-TE/400)
  (cpe-TE-1)
  "cpe133"
  "cpe329"
  "cpe315"
  (cpe-sp-1)
  (cpe-sp-2)
  (cpe-TE-0)
  (cpe-TE/123))))))

  (check-equal? (list->set (hash-keys test-val))
                (list->set (hash-keys expected-val))
                "hash table keys")

  (for ([k (in-list (set-intersect (hash-keys test-val) (hash-keys expected-val)))])
    (define test-s (hash-ref test-val k))
    (define expected-s (hash-ref expected-val k))
    (when (not (equal? test-s expected-s))
      (printf "test - expected: ~e"
              (set-subtract test-s expected-s))
      (printf "test - expected: ~e"
              (set-subtract expected-s test-s)))
    (check-equal?
     (hash-ref test-val k)
     (hash-ref expected-val k)
     (format "value for key ~e" k)))

  )



